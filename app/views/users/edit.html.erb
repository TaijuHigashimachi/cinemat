<% content_for(:title, t('.title')) %>
<div class="form-wrapper mx-auto text-center mb-5">
  <h1><%= t('.title') %></h1>

  <%= simple_form_for @user, :html => { :class => 'mr-3 text-start' } do |f| %>
    <%= render 'shared/error_messages', object: f.object %>
    <div class="form-group">
      <%= f.input :name, label_html: { class: 'mt-3' } %>
      <%= f.input :email, label_html: { class: 'mt-3' } %>
      <%= image_tag @user.avatar.url, id: 'preview', class: 'profile-image mt-3' %>
      <%= f.input :avatar, :input_html => {:onchange => "previewImage(preview)"}, label_html: { class: 'mt-1' } %>
      <%= f.input :avatar_cache, :as => :hidden %>
    </div>
    <div class="form-group">
      <%= f.button :submit, class: 'btn btn-primary mt-3' %>
    </div>
  <% end %>
</div>

<script>
function previewImage() {
    const target = this.event.target;
    const file = target.files[0];
    const reader  = new FileReader();
    reader.onloadend = function () {
        const preview = document.querySelector("#preview")
        if(preview) {
            preview.src = reader.result;
        }
    }
    if (file) {
        reader.readAsDataURL(file);
    }
}
</script>
